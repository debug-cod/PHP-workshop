<?php
/** @var stdClass $view */
?>
<div class="container mt-4">
    <h2>Exercise 6.4 - Mini Shop</h2>

    <?php if (!isset($_SESSION['loggedin'])): ?>
        <!-- 登录表单 -->
        <div class="row">
            <div class="col-md-6">
                <h3>Login to Shop</h3>
                <?php if ($view->errorMessage): ?>
                    <div class="alert alert-danger"><?php echo $view->errorMessage; ?></div>
                <?php endif; ?>

                <form method="post" action="minishop.php">
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="username" class="form-control" required
                               placeholder="Enter username">
                    </div>

                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" class="form-control" required
                               placeholder="Enter password">
                    </div>

                    <button type="submit" name="loginbutton" class="btn btn-primary">Login</button>
                </form>

                <div class="mt-3">
                    <small class="text-muted">
                        Demo credentials: <strong>admin / password123</strong>
                    </small>
                </div>
            </div>
        </div>

    <?php else: ?>
        <!-- 用户已登录 -->
        <div class="alert alert-success">
            <h4>Welcome, <?php echo $_SESSION['username']; ?>!</h4>
            <form method="post" action="minishop.php" class="d-inline">
                <button type="submit" name="logoutbutton" class="btn btn-warning btn-sm">Logout</button>
            </form>
        </div>

        <?php if ($view->purchasedProduct): ?>
            <!-- 显示购买的产品 -->
            <div class="alert alert-info">
                <h4>Thank you for your purchase!</h4>
                <p>You bought: <strong><?php echo $view->purchasedProduct['name']; ?></strong></p>
                <p>Price: <strong>£<?php echo number_format($view->purchasedProduct['price'], 2); ?></strong></p>
            </div>
        <?php endif; ?>

        <!-- 产品列表 -->
        <h3>Available Products</h3>
        <div class="row">
            <?php
            // 产品数据数组
            $products = [
                '1' => [
                    'name' => 'Laptop',
                    'price' => 999.99,
                    'description' => 'High-performance laptop with 16GB RAM'
                ],
                '2' => [
                    'name' => 'Smartphone',
                    'price' => 599.99,
                    'description' => 'Latest smartphone with advanced camera'
                ],
                '3' => [
                    'name' => 'Headphones',
                    'price' => 149.99,
                    'description' => 'Noise-cancelling wireless headphones'
                ],
                '4' => [
                    'name' => 'Tablet',
                    'price' => 399.99,
                    'description' => '10-inch tablet perfect for work and entertainment'
                ]
            ];

            foreach ($products as $id => $product): ?>
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title"><?php echo $product['name']; ?></h5>
                            <p class="card-text"><?php echo $product['description']; ?></p>
                            <p class="card-text"><strong>£<?php echo number_format($product['price'], 2); ?></strong></p>

                            <!-- 购买表单 -->
                            <form method="post" action="minishop.php">
                                <input type="hidden" name="product_id" value="<?php echo $id; ?>">
                                <button type="submit" name="buybutton" class="btn btn-success btn-block">Buy Now</button>
                            </form>
                        </div>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>

    <?php endif; ?>
</div>